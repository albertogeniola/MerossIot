<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Common gotchas &mdash; MerossIot Library  documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
        <script data-ad-client="ca-pub-9110025741700767" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced topics" href="advanced-topics.html" />
    <link rel="prev" title="Quick start" href="quick-start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="index.html" class="icon icon-home"> MerossIot Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Common gotchas</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced-topics.html">Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="meross-protocol.html">Meross Protocol Inspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MerossIot Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Common gotchas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/common-gotchas.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="common-gotchas">
<h1>Common gotchas<a class="headerlink" href="#common-gotchas" title="Permalink to this headline">¶</a></h1>
<p>There are a number of common errors that you might be experiencing when approaching to this library
for the first time. In this section, we enumerate the most common ones, and we’ll keep updating it as new
ones are discovered.</p>
<dl>
<dt>RuntimeError: Event loop is closed</dt><dd><p>This error occurs when you are running this library with Python 3.8 on a Windows machine.
The cause of this error is related to <code class="code docutils literal notranslate"><span class="pre">ProactorEventLoop</span></code> which is used on Python 3.8.
To solve that, you can setup asyncio library to use a different event loop implementation, which does not
cause that error. To do so, add this line on top of your script</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop_policy</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">WindowsSelectorEventLoopPolicy</span><span class="p">())</span>
</pre></div>
</div>
</dd>
<dt>Calling awaitable the wrong way</dt><dd><p>This library implements the asyncio pattern. As a result, you should be aware of how to
call asynchronous methods. Calling an asynchronous method without the preceding <cite>await</cite>
keyword does not actually invoke the method.</p>
</dd>
<dt>Too many tokens</dt><dd><p>This error occurs when your account has logged in many times against the Meross Cloud endpoint without
releasing any previously acquired token.
This is usually caused by an abuse of the <cite>MerossManager</cite> or the <cite>MerossHttpClient</cite> classes: when using these
classes, the developer must close() / logout() the object before ending the script.
In order to avoid hitting this API error, make sure to always invoke close()/logout() methods before ending the
script.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Meross API usually blocks the user for 12/24 hours when reaching the token limit.
After 12/24 hours, the API starts working again.</p>
</div>
</dd>
<dt>Inconsistent device state</dt><dd><p>The current implementation of the library keeps the device status aligned by listening to PUSH notifications
received from the Meross MQTT broker. However, the first time the developer accesses the device state,
the device state may be inconsistent. For this reason, each device implements the <cite>async_update()</cite> method,
which fetches the complete device state. From that moment on, the library automatically handles state update
by listening for push notifications.</p>
<p>There are some edge cases in which the device state could become inconsistent. This happens, for instance,
when the MerossManager looses the connection to the MQTT broker and someone else changes the device state
(e.g. someone using the Meross app. In this case, the MerossManager looses the PUSH notification message
as it’s disconnected while the app sends the command to the device.</p>
<p>To avoid such situations, developers should call the <cite>async_update()</cite> every time the internet connection is
lost and then restored.</p>
</dd>
<dt>Ban from Meross cloud</dt><dd><p>Meross security team may suspend the user accounts that perform too many requests.
In some cases, an automated email is delivered to the email address of the user account,
warning him about imminent suspension. In other cases, the account might be suspended without any notice.
If that happens, the user need to contact Meross team and ask for ban-removal.
In any case, to prevent that from happening, be sure to limit calls to HTTP APIs.</p>
<p>At the time of writing, such rate limits are not documented. It’s up to the Developer to properly
handle rate limiting strategies to avoid Meross ban.</p>
</dd>
</dl>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quick-start.html" class="btn btn-neutral float-left" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="advanced-topics.html" class="btn btn-neutral float-right" title="Advanced topics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Alberto Geniola.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10387182-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-10387182-6', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>