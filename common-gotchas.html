

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Common gotchas &mdash; MerossIot Library  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Meross Architecture" href="meross-arch.html" />
    <link rel="prev" title="Quick start" href="quick-start.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MerossIot Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Common gotchas</a></li>
<li class="toctree-l1"><a class="reference internal" href="meross-arch.html">Meross Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced-topics.html">Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MerossIot Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Common gotchas</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/common-gotchas.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="common-gotchas">
<h1>Common gotchas<a class="headerlink" href="#common-gotchas" title="Permalink to this headline">¶</a></h1>
<p>There are a number of common error that you might be experiencing when approaching to this library
for the first time. In this section, we enumerate the known ones and we’ll keep updating it as new
ones are discovered.</p>
<dl>
<dt>RuntimeError: Event loop is closed</dt><dd><p>This error occurs when you are running this library with Python 3.8 on a Windows machine.
The cause of this error is related to ProactorEventLoop which is used on Python 3.8.
To solve that, you can setup asyncio library to use a different event loop implementation, which does not
cause that error. To do so, add this line on top of your script</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop_policy</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">WindowsSelectorEventLoopPolicy</span><span class="p">())</span>
</pre></div>
</div>
</dd>
<dt>Calling awaitable the wrong way</dt><dd><p>This library implements the asyncio pattern. As a result, you should be aware of how to
call asynchronous methods. Calling an asynchronous method without the preceding <cite>await</cite>
keyword does not actually invoke the method.</p>
</dd>
<dt>Too many tokens</dt><dd><p>This error occurs when your account has logged in many times against the Meross Cloud endpoint without
releasing any previously acquired token.
This is usually caused by an abuse of the <cite>MerossManager</cite> or the <cite>MerossHttpClient</cite> classes: when using these
classes, the developer must close() / logout() the object before ending the script.
In order to avoid hitting this API error, make sure to always invoke close()/logout() methods before ending the
script.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Meross API usually blocks the user for 12/24 hours when reaching the token limit.
After 12/24 hours, the API starts working again.</p>
</div>
</dd>
<dt>Inconsistent device state</dt><dd><p>The current implementation of the library keeps the device status aligned by listening to PUSH notifications
received from the Meross MQTT broker. However, the first time the developer accesses the device state,
the device state may be inconsistent. For this reason, each device implements the <cite>async_update()</cite> method,
which fetches the complete device state. From that moment on, the library automatically handles state update
by listening for push notifications.</p>
<p>There are some edge cases in which the device state could become inconsistent. This happens, for instance,
when the MerossManager looses the connection to the MQTT broker and someone else changes the device state
(e.g. someone using the Meross app. In this case, the MerossManager looses the PUSH notification message
as it’s disconnected while the app sends the command to the device.</p>
<p>To avoid such situations, developers should call the <cite>async_update()</cite> every time the internet connection is
lost and then restored.</p>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="meross-arch.html" class="btn btn-neutral float-right" title="Meross Architecture" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quick-start.html" class="btn btn-neutral float-left" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Alberto Geniola

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>